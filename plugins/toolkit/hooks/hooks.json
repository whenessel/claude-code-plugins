{
  "description": "Automatic task formalization for low-quality user prompts",
  "hooks": {
    "UserPromptSubmit": [
      {
        "hooks": [
          {
            "type": "prompt",
            "prompt": "# Task Quality Pre-Processing\n\nBefore executing this user request, evaluate its clarity and structure:\n\n---\nUSER REQUEST:\n$USER_PROMPT\n---\n\n## Quality Evaluation Criteria\n\nScore the request on a 0.0-1.0 scale based on:\n\n| Factor | High (+0.2) | Low (−0.2) |\n|--------|-------------|------------|\n| Goal clarity | Single, clear objective | Vague or multiple goals |\n| Requirements | Explicit, testable | Implied, subjective |\n| Scope | Well-bounded | Open-ended (\"improve\", \"clean up\") |\n| Dependencies | Stated or none | Implicit, circular |\n| Definition of Done | Clear completion criteria | Missing or ambiguous |\n\n## Decision Logic\n\n**If confidence ≥ 0.6**: Proceed directly with the user's request as-is. Don't formalize.\n\n**If confidence < 0.6**: The request is too vague/complex. You MUST:\n\n1. **DO NOT execute the request directly**\n2. **Invoke the formalizer agent** using the Task tool:\n   ```\n   Task(\n     description=\"Formalize user request\",\n     prompt=\"Formalize this user input: [USER_PROMPT]\",\n     subagent_type=\"toolkit:formalizer\"\n   )\n   ```\n3. **Use the formalized output** from the agent as the actual task specification\n4. **Then proceed** with implementation based on the structured spec\n\n## Special Cases\n\n**Skip formalization** (always confidence = 1.0) when:\n- User is asking a question (not requesting action)\n- Single atomic action (\"run tests\", \"format file.ts\")\n- User explicitly says \"just do it\" or \"no planning\"\n- Request is already structured with clear DoD\n\n## Examples\n\n**High quality (0.9) - Proceed directly:**\n> \"Add a console.log statement in src/utils.ts at line 42 to debug the API response\"\n\n**Medium quality (0.65) - Proceed directly:**\n> \"Fix the authentication bug in the login flow\"\n\n**Low quality (0.4) - MUST formalize first:**\n> \"clean up the code and make it work like the other service\"\n→ Invoke formalizer agent, get structured spec, then implement\n\n**Multi-objective (0.5) - MUST formalize first:**\n> \"fix auth bug, update docs, deploy to staging if tests pass\"\n→ Invoke formalizer to decompose into ordered tasks with dependencies\n\n## Implementation Note\n\nThe formalizer agent will return a structured specification with:\n- CONFIDENCE score\n- MODE (silent/summary/clarify)\n- Formalized tasks with DoD\n- Dependency graph if multi-task\n\nUse that output as your execution blueprint.",
            "description": "Auto-analyze user prompt quality and invoke formalizer for low-quality requests"
          }
        ]
      }
    ]
  }
}
