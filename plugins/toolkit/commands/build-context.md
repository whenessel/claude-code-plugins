---
name: build-context
description: Analyze project source code and generate structured context documentation
argument-hint: "[scope or path] [--deep|--shallow] [--output <path>]"
---

# Build Context Command

Analyze the project codebase and produce a structured context document that maps architectural layers, module boundaries, public APIs, and dependency relationships.

## Usage

```bash
/build-context
/build-context src/auth/
/build-context --deep
/build-context the recording layer --output .claude/context/recording.md
```

## When to Use

Use `/build-context` when:
- Starting work in an unfamiliar codebase
- Planning a major refactoring or feature
- Onboarding onto a new project area
- Documenting architecture for another developer/agent
- Preparing context before delegating to a subagen

## Arguments

- **scope/path** (optional): Focus analysis on specific area
  - `src/auth/` — Analyze authentication module
  - `the payment layer` — Natural language scope
  - Omit for full project overview

- **--deep**: Include full API surface with signatures and line numbers
- **--shallow**: Module names and paths only (fast)
- **--output <path>**: Custom output location (default: `.claude/context/<slug>.md`)

## How It Works

The command invokes the `context-builder` agent which:

1. **Orients**: Detects project type, languages, structure (monorepo/single-package)
2. **Discovers layers**: Maps logical modules/packages and their purposes
3. **Extracts APIs**: Documents public interfaces from entry points
4. **Maps dependencies**: Identifies cross-module dependencies and data flow
5. **Writes document**: Structured markdown with layers, APIs, dependency graph

The agent uses its project-level memory to cache architectural patterns and avoid re-analyzing unchanged areas.

## Implementation

```python
# Parse arguments
scope = extract_scope(arguments)  # "src/auth/", "the recording layer", etc.
depth = "deep" if "--deep" in arguments else "shallow" if "--shallow" in arguments else "normal"
output_path = extract_output_path(arguments) or f".claude/context/{slugify(scope)}.md"

# Invoke agent
Task(
  description="Build project context",
  prompt=f"""
  Analyze the project and create a context document.

  Scope: {scope or "full project overview"}
  Depth: {depth}
  Output: {output_path}

  Use the build-context skill to analyze architectural layers, public APIs,
  and dependency relationships. Write the result to the specified output path.
  """,
  subagent_type="toolkit:context-builder"
)
```

## Output Structure

The generated context document follows this format:

```markdown
# Context: [Task or Scope Title]

> Generated by context-builder on [date]
> Scope: [what was analyzed]
> Depth: [shallow|normal|deep]

## Project Overview

[1-3 sentences: project type, languages, frameworks, structure pattern]

## Layers

### [Layer Name]

- **Path:** `relative/path/`
- **Purpose:** [what this layer does]
- **Entry:** `relative/path/to/entry-point`

**Public API:**

| Symbol           | Kind  | File                     | Line |
| ---------------- | ----- | ------------------------ | ---- |
| `SessionManager` | class | `src/session/manager.ts` | 42   |

[repeat for each layer]

## Dependency Map

Layer A → Layer B → Layer C
↘ Layer D

[prose description of data flow and key integration points]

## Files Examined

- `src/session/index.ts` — barrel export, entry point
- `src/session/manager.ts` — SessionManager (lines 30–150)

## Task Notes

[Patterns, conventions, observations, potential issues]
```

## Depth Modes

**Shallow** (fastest):
- Top-level modules only
- Names and paths
- No API details

**Normal** (default):
- Modules + key exports
- Purpose and role classification
- Entry point identification

**Deep** (comprehensive):
- Full public API surface
- Function signatures with line numbers
- Detailed dependency analysis

## Error Handling

**No valid project structure:**
```
Error: Cannot detect project structure. No package.json, Cargo.toml, go.mod, or
other project markers found in the current directory.

Are you in a project root directory?
```

**Scope too large:**
```
Warning: Analysis requires reading 200+ files. This may take a while.

Recommendations:
- Narrow scope: /build-context src/specific-module/
- Use --shallow for faster overview
- Split into multiple focused analyses
```

## Examples

**Full project overview:**
```bash
/build-context
# Output: .claude/context/project-overview.md
```

**Focused on authentication:**
```bash
/build-context src/auth/
# Output: .claude/context/auth.md
```

**Deep analysis with custom output:**
```bash
/build-context the payment layer --deep --output docs/architecture/payments.md
```

**Quick module listing:**
```bash
/build-context --shallow
# Fast scan, module names only
```

## Memory Integration

The `context-builder` agent uses project-level memory to:
- Cache layer information across sessions
- Avoid re-analyzing unchanged areas
- Remember architectural patterns and conventions
- Track project evolution over time

Memory is stored in `.claude/memory/context-builder/` and persists across conversations.

## See Also

- `/task-context` — Create task-scoped context (focused on specific feature/branch)
- `/formalize` — Structure vague requests before building context
- `agents/context-builder.md` — Agent implementation details
